<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Usage · Sim.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>Sim.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li><a class="toctext" href="../overview/">Overview</a></li><li class="current"><a class="toctext" href>Usage</a><ul class="internal"><li><a class="toctext" href="#Modeling-and-simulation-1">Modeling and simulation</a></li><li><a class="toctext" href="#Logging-1">Logging</a></li></ul></li><li><a class="toctext" href="../examples/">Examples</a></li><li><a class="toctext" href="../internals/">Internals</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Usage</a></li></ul><a class="edit-page" href="https://github.com/pbayer/Sim.jl/blob/master/docs/src/usage.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Usage</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="User-guide-1" href="#User-guide-1">User guide</a></h1><p><code>Sim.jl</code> is not yet an registered package and is installed with</p><pre><code class="language-julia">pkg&gt; add(&quot;https://github.com/pbayer/jl&quot;)</code></pre><p>The package is then loaded with</p><pre><code class="language-julia-repl">julia&gt; using Sim</code></pre><h2><a class="nav-anchor" id="Modeling-and-simulation-1" href="#Modeling-and-simulation-1">Modeling and simulation</a></h2><p>A virtual <code>Clock</code> allows to schedule Julia expressions as timed events or as sampling actions, which occur at predefined clock ticks. When we <code>run</code> the <code>Clock</code>, it fires the events at their scheduled times and executes the sampling actions at each tick.</p><h3><a class="nav-anchor" id="Silly-example-1" href="#Silly-example-1">Silly example</a></h3><pre><code class="language-julia-repl">julia&gt; m = @__MODULE__ # catching the current module is needed for documentation
Main.ex-usage

julia&gt; using Printf

julia&gt; sim = Clock(); # create a clock

julia&gt; comm = [&quot;Hi, nice to meet you!&quot;, &quot;How are you?&quot;, &quot;Have a nice day!&quot;];

julia&gt; greet(name, n) =  @printf(&quot;%5.2f s, %s: %s\n&quot;, now(sim), name, comm[n])
greet (generic function with 1 method)

julia&gt; function foo(n) # 1st passerby
           greet(&quot;Foo&quot;, n)
           event!(sim, :(bar($n)), after, 2*rand(), scope = m)
       end
foo (generic function with 1 method)

julia&gt; function bar(n) # 2nd passerby
           greet(&quot;Bar&quot;, n)
           if n &lt; 3
              event!(sim, :(foo($n+1)), after, 2*rand(), scope = m)
           else
              println(&quot;bye bye&quot;)
           end
       end
bar (generic function with 1 method)

julia&gt; event!(sim, :(foo(1)), at, 10*rand(), scope = m); # create an event for a start

julia&gt; run!(sim, 20) # and run the simulation
 9.91 s, Foo: Hi, nice to meet you!
10.33 s, Bar: Hi, nice to meet you!
12.23 s, Foo: How are you?
13.47 s, Bar: How are you?
15.05 s, Foo: Have a nice day!
16.55 s, Bar: Have a nice day!
bye bye
Finished: 6 events, simulation time: 20.0</code></pre><h3><a class="nav-anchor" id="Types-1" href="#Types-1">Types</a></h3><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.Clock" href="#Sim.Clock"><code>Sim.Clock</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Clock(Δt::Number=0; t0::Number=0)</code></pre><p>Create a new simulation clock.</p><p><strong>Arguments</strong></p><ul><li><code>Δt::Number=0</code>: time increment</li><li><code>t0::Number=0</code>: start time for simulation.</li></ul><p>If no Δt is given, the simulation doesn&#39;t tick, but jumps from event to event. Δt can be set later with <code>sample_time!</code>.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L55-L66">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.Timing" href="#Sim.Timing"><code>Sim.Timing</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Timing</code></pre><p>Enumeration type for scheduling events and timed conditions:</p><ul><li><code>at</code>: schedule an event at agiven time</li><li><code>after</code>: schedule an event a given time after current time</li><li><code>every</code>: schedule an event every given time from now</li><li><code>before</code>: a timed condition is true before a given time.</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/JuliaLang/julia/blob/c6da87ff4bc7a855e217856757ad3413cf6d1f79/base/#L0-L9">source</a></section><h3><a class="nav-anchor" id="Functions-1" href="#Functions-1">Functions</a></h3><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.now" href="#Sim.now"><code>Sim.now</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">now(sim::Clock)</code></pre><p>Return the current simulation time.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L98-L102">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.sample_time!" href="#Sim.sample_time!"><code>Sim.sample_time!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">sample_time!(sim::Clock, Δt::Number)</code></pre><p>set the clock&#39;s sampling time from <code>now(sim)</code>.</p><p><strong>Arguments</strong></p><ul><li><code>sim::Clock</code></li><li><code>Δt::Number</code>: sample rate, time interval for sampling</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L159-L167">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.event!" href="#Sim.event!"><code>Sim.event!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">    event!(sim::Clock, expr::Expr, t::Number; scope::Module=Main, cycle::Number=0.0)::Float64
    event!(sim::Clock, expr::Expr, T::Timing, t::Number; scope::Module=Main)::Float64</code></pre><p>Schedule an expression for execution at a given simulation time.</p><p><strong>Arguments</strong></p><ul><li><code>sim::Clock</code>: simulation clock</li><li><code>expr::Expr</code>: an expression</li><li><code>t::Float64</code>: simulation time</li><li><code>scope::Module=Main</code>: scope for the expression to be evaluated</li><li><code>cycle::Float64=0.0</code>: repeat cycle time for the event</li><li><code>T::Timing</code>: a timing, <code>at</code>, <code>after</code> or <code>every</code> (<code>before</code> behaves like <code>at</code>)</li></ul><p><strong>returns</strong></p><p>Scheduled simulation time for that event.</p><p>May return a time <code>t &gt; at</code> from repeated applications of <code>nextfloat(at)</code> if there were yet events scheduled for that time.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L119-L139">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.sample!" href="#Sim.sample!"><code>Sim.sample!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">sample!(sim::Clock, expr::Expr; scope::Module=Main)</code></pre><p>enqueue an expression for sampling.</p><p><strong>Arguments</strong></p><ul><li><code>sim::Clock</code></li><li><code>expr::Expr</code>: a Julia expression</li><li><code>scope::Module=Main</code>: optional, a scope for the expression to be evaluated in</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L173-L182">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.incr!" href="#Sim.incr!"><code>Sim.incr!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">incr!(sim::Clock)</code></pre><p>Take one simulation step, execute the next tick or event.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L325-L329">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.run!" href="#Sim.run!"><code>Sim.run!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">run!(sim::Clock, duration::Number)</code></pre><p>Run a simulation for a given duration.</p><p>Call scheduled events and evaluate sampling expressions at each tick in that timeframe.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L316-L322">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.stop!" href="#Sim.stop!"><code>Sim.stop!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">stop!(sim::Clock)</code></pre><p>Stop a running simulation.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L332-L336">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.resume!" href="#Sim.resume!"><code>Sim.resume!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">resume!(sim::Clock)</code></pre><p>Resume a halted simulation.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L339-L343">source</a></section><h2><a class="nav-anchor" id="Logging-1" href="#Logging-1">Logging</a></h2><p>A <code>Logger</code> allows to register variables and to record their states on demand. The last record is stored in the logging variable. According to the Logger&#39;s state it can be printed or stored in a table.</p><h3><a class="nav-anchor" id="Example-1" href="#Example-1">Example</a></h3><pre><code class="language-julia-repl">julia&gt; sim = Clock(); # create a clock

julia&gt; l = Logger(); # create a logging variable

julia&gt; init!(l, sim); # initialize the logger

julia&gt; (a, b, c) = 1, 1, 1 # create some variables
(1, 1, 1)

julia&gt; setup!(l, [:a, :b, :c], scope = m); # register them for logging

julia&gt; record!(l) # record the variables with the current clock time

julia&gt; l.last # show the last record
(time = 0.0, a = 1, b = 1, c = 1)

julia&gt; function f()  # a function for increasing and recording the variables
         global a += 1
         global b = a^2
         global c = a^3
         record!(l)
       end
f (generic function with 1 method)

julia&gt; switch!(l, 1); # switch logger to printing

julia&gt; f() # increase and record the variables
(time = 0.0, a = 2, b = 4, c = 8)

julia&gt; switch!(l, 2); # switch logger to storing in data table

julia&gt; for i in 1:10 # create some events
           event!(sim, :(f()), i, scope = m)
       end

julia&gt; run!(sim, 10) # run a simulation
Finished: 10 events, simulation time: 10.0

julia&gt; l.df # view the recorded values
10×4 DataFrames.DataFrame
│ Row │ time    │ a     │ b     │ c     │
│     │ Float64 │ Int64 │ Int64 │ Int64 │
├─────┼─────────┼───────┼───────┼───────┤
│ 1   │ 1.0     │ 3     │ 9     │ 27    │
│ 2   │ 2.0     │ 4     │ 16    │ 64    │
│ 3   │ 3.0     │ 5     │ 25    │ 125   │
│ 4   │ 4.0     │ 6     │ 36    │ 216   │
│ 5   │ 5.0     │ 7     │ 49    │ 343   │
│ 6   │ 6.0     │ 8     │ 64    │ 512   │
│ 7   │ 7.0     │ 9     │ 81    │ 729   │
│ 8   │ 8.0     │ 10    │ 100   │ 1000  │
│ 9   │ 9.0     │ 11    │ 121   │ 1331  │
│ 10  │ 10.0    │ 12    │ 144   │ 1728  │</code></pre><h3><a class="nav-anchor" id="Types-2" href="#Types-2">Types</a></h3><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.Logger" href="#Sim.Logger"><code>Sim.Logger</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Logger()</code></pre><p>Setup and return a logging variable.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L5-L9">source</a></section><h3><a class="nav-anchor" id="Functions-2" href="#Functions-2">Functions</a></h3><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.init!" href="#Sim.init!"><code>Sim.init!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">init!(sim::Clock)</code></pre><p>initialize a clock.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Clock.jl#L346-L350">source</a><div><div><pre><code class="language-none">init!(L::Logger, sim::Clock)</code></pre><p>Initialize a Logger.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L95-L99">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.setup!" href="#Sim.setup!"><code>Sim.setup!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">setup!(L::Logger, vars::Array{Symbol})</code></pre><p>Setup a logger with logging variables.</p><p><strong>Arguments</strong></p><ul><li><code>L::Logger</code></li><li><code>vars::Array{Symbol}</code>: An array of symbols, e.g. of global variables</li><li><code>scope::Module = Main</code>: Scope in which to evaluate the variables</li></ul></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L102-L111">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.switch!" href="#Sim.switch!"><code>Sim.switch!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">switch!(L::Logger, to::Number=0)</code></pre><p>Switch the operating mode of a logger.</p><p><code>to = 0</code>: no output, <code>to = 1</code>: print, `to = 2: store in log table&quot;</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L86-L92">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.record!" href="#Sim.record!"><code>Sim.record!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">record!(L::Logger)</code></pre><p>record the logging variables with the current operating mode.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L115-L119">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="Sim.clear!" href="#Sim.clear!"><code>Sim.clear!</code></a> — <span class="docstring-category">Function</span>.</div><div><div><pre><code class="language-julia">clear!(L::Logger)</code></pre><p>clear the loggers last record and data table.</p></div></div><a class="source-link" target="_blank" href="https://github.com/pbayer/Sim.jl/blob/2b8ba43666dc88d68a232e8d1c379a4e976ead88/src/Logger.jl#L122-L126">source</a></section><footer><hr/><a class="previous" href="../overview/"><span class="direction">Previous</span><span class="title">Overview</span></a><a class="next" href="../examples/"><span class="direction">Next</span><span class="title">Examples</span></a></footer></article></body></html>
