<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Parallel Simulation · DiscreteEvents.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">DiscreteEvents.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../news/">News</a></li><li><a class="tocitem" href="../intro/">Introduction</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../setup/">Installation</a></li><li><a class="tocitem" href="../clocks/">Clocks</a></li><li><a class="tocitem" href="../events/">Events</a></li><li><a class="tocitem" href="../processes/">Processes</a></li><li><a class="tocitem" href="../actors/">Actors</a></li><li><a class="tocitem" href="../resources/">Resources</a></li><li class="is-active"><a class="tocitem" href>Parallel Simulation</a><ul class="internal"><li><a class="tocitem" href="#Multi-Threading-(Experimental)"><span>Multi-Threading (Experimental)</span></a></li><li><a class="tocitem" href="#Thread-local-Clocks"><span>Thread-local Clocks</span></a></li><li><a class="tocitem" href="#Speedup-and-Balance"><span>Speedup and Balance</span></a></li><li><a class="tocitem" href="#Random-Numbers"><span>Random Numbers</span></a></li><li><a class="tocitem" href="#Documentation-and-Examples"><span>Documentation and Examples</span></a></li></ul></li><li><a class="tocitem" href="../usage/">Utilities</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../internals/">Internals</a></li><li><a class="tocitem" href="../troubleshooting/">Troubleshooting</a></li><li><a class="tocitem" href="../history/">Version history</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Parallel Simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Parallel Simulation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pbayer/DiscreteEvents.jl/blob/master/docs/src/parallel.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Parallel-Simulation"><a class="docs-heading-anchor" href="#Parallel-Simulation">Parallel Simulation</a><a id="Parallel-Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Parallel-Simulation" title="Permalink"></a></h1><p>You can parallelize simulations in two ways:</p><ol><li>You can do <em>independent parallel simulations</em> with the <a href="https://docs.julialang.org/en/v1/manual/multi-threading/#The-@threads-Macro"><code>@threads</code>-macro</a> <sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> or with the <a href="https://docs.julialang.org/en/v1/stdlib/Distributed/"><code>Distributed</code> standard library</a>.</li><li>You can execute a single simulation on multiple threads to speed it up.</li></ol><h2 id="Multi-Threading-(Experimental)"><a class="docs-heading-anchor" href="#Multi-Threading-(Experimental)">Multi-Threading (Experimental)</a><a id="Multi-Threading-(Experimental)-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Threading-(Experimental)" title="Permalink"></a></h2><p>Multithreading of simulations is introduced with <code>DiscreteEvents</code> v0.3 and will take some time to become stable. Please try it out and report your problems!</p><p>If we compute events of a DES on parallel cores of a computer, we may reverse a sequence <span>$\;e_i, e_j\;$</span> to  <span>$\;e_j, e_i\;$</span>. If there is causality between those events, we have a problem. Therefore we cannot spawn arbitrary events to parallel cores without altering causality and the simulated outcome.</p><p>Fortunately not all events in larger DES are strongly coupled. For most practical purposes we can divide systems into subsystems where events depend on each other but not or only statistically on events in other subsystems. Subsystems have local time and their clocks get synchronized periodically.</p><h2 id="Thread-local-Clocks"><a class="docs-heading-anchor" href="#Thread-local-Clocks">Thread-local Clocks</a><a id="Thread-local-Clocks-1"></a><a class="docs-heading-anchor-permalink" href="#Thread-local-Clocks" title="Permalink"></a></h2><p>With <a href="../clocks/#DiscreteEvents.PClock"><code>PClock</code></a> we introduce parallel local clocks on each thread. The master clock on thread 1 synchronizes with its parallel clocks each chosen time interval <span>$\;Δt\;$</span>. Synchronization takes some time and the slowest thread with the biggest workload (usually thread 1) sets the pace for the whole computation.</p><p>When using the keywords <code>cid</code> or <code>spawn</code> with <a href="../events/"><code>event!</code></a>, <a href="../events/#DiscreteEvents.periodic!"><code>periodic!</code></a> and <a href="../processes/#DiscreteEvents.process!"><code>process!</code></a> we can work with parallel clocks. Then</p><ul><li>events and processes get registered to parallel clocks,</li><li>processes get started on parallel threads and</li><li>their functions get the thread local clock to <a href="../processes/#DiscreteEvents.delay!"><code>delay!</code></a> or <a href="../processes/#DiscreteEvents.wait!"><code>wait!</code></a> on it.</li></ul><p>A user should avoid to share global variables between threads in order not to get race conditions. If thread-local subsystems get inputs from each other, they should communicate over Julia channels, which are thread safe.</p><p>When working on parallel threads, we have thread-local random number generators. Random number sequences therefore are not identical between single-threaded and multithreaded applications (see below). This usually causes also simulation results to be different.</p><h2 id="Speedup-and-Balance"><a class="docs-heading-anchor" href="#Speedup-and-Balance">Speedup and Balance</a><a id="Speedup-and-Balance-1"></a><a class="docs-heading-anchor-permalink" href="#Speedup-and-Balance" title="Permalink"></a></h2><p>First results show a considerable speedup of multithreaded simulations vs single-threaded ones:</p><ol><li>The <a href="https://pbayer.github.io/DiscreteEventsCompanion.jl/dev/examples/assy_thrd/">Multithreaded Assembly Line</a> on <code>DiscreteEventsCompanion</code> took 1.58 s to run 63452 events on 8 parallel cores vs. 70287 events in 10.77 s on thread 1 of the same machine <sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</li><li>If we put the simulated assembly operations only on threads 2-8, it took only 0.67 s.</li><li>With all assembly operations together on thread 2, it took 4.96 s.</li></ol><p>The 2nd and 3rd results show that considerable speedups can yet be realized by relieving thread 1 and distributing the workload between the other ones.</p><h2 id="Random-Numbers"><a class="docs-heading-anchor" href="#Random-Numbers">Random Numbers</a><a id="Random-Numbers-1"></a><a class="docs-heading-anchor-permalink" href="#Random-Numbers" title="Permalink"></a></h2><p>To get reproducible but different random number sequences on each thread, you can seed the <a href="https://julialang.org/blog/2019/07/multithreading/#random_number_generation">thread-specific global default random number generators</a> with <a href="../usage/#DiscreteEvents.pseed!"><code>pseed!</code></a>. It will <code>seed!</code> the thread-specific default RNGs with the given number multiplied by the thread id <span>$n\times t_i$</span>. Calls to <code>rand()</code> are thread-specific and will then use the seeded default RNGs.</p><p>At this time of writing all implicit calls to <code>rand()</code> in timed <a href="../events/#DiscreteEvents.event!-Union{Tuple{U}, Tuple{A}, Tuple{CL}, Tuple{CL,A,U}} where U&lt;:Number where A&lt;:Union{Expr, Function, Tuple{Vararg{Union{Expr, Function},N} where N}} where CL&lt;:DiscreteEvents.AbstractClock"><code>event!</code></a>s or in <a href="../processes/#DiscreteEvents.delay!"><code>delay!</code></a> use the default RNGs.</p><p>Alternatively you can seed a thread-specific default RNG with:</p><pre><code class="language-julia">using DiscreteEvents, Random

onthread(2) do  # seed the default RNG on thread 2
    Random.seed!(123)
end</code></pre><h2 id="Documentation-and-Examples"><a class="docs-heading-anchor" href="#Documentation-and-Examples">Documentation and Examples</a><a id="Documentation-and-Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Documentation-and-Examples" title="Permalink"></a></h2><p>You can find more <a href="https://pbayer.github.io/DiscreteEventsCompanion.jl/dev/parallel/">documentation</a> and <a href="https://pbayer.github.io/DiscreteEventsCompanion.jl/dev/examples/examples/#Multi-Threading-(Experimental)">examples</a> on <code>DiscreteEventsCompanion</code>.</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="https://pbayer.github.io/DiscreteEventsCompanion.jl/dev/examples/dicegame/dicegame/">Goldratt&#39;s Dice Game</a> on <code>DiscreteEventsCompanion</code> illustrates how to do this.</li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Event count and line throughput are different between multi- and single-threaded because the random number sequence changes between these examples.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../resources/">« Resources</a><a class="docs-footer-nextpage" href="../usage/">Utilities »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 13 September 2020 16:45">Sunday 13 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
